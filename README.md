# A python script for Swift/XRT data reduction 

A simple python3 script runs xrtpipeline, xrtproducts and xrtmkarf to generate the PC & WT pointing mode lightcurves and spectrums.

## Files:
- xrt_repro.py: The main script
- xrt_repro_func.py: Python file contains the functions used in the main script.

## Output files:

The output files should have:
- lightcurves:
  - sw[obsid]x[mode][ww]posr_corr.lc (cleaned source lightcurve)
  - sw[obsid]x[mode][ww]posr.lc (source lightcurve)
  - sw[obsid]x[mode][ww]pobkg.lc (background lightcurve)
- spectrums:
  - sw[obsid]x[mode][ww]posr_grp.pha (groupped spectrum, with the newest RMF and ARF.)
  - sw[obsid]x[mode][ww]posr.pha (source spectrum)
  - sw[obsid]x[mode][ww]pobkg.pha (background spectrum)
- others:
  - sw[obsid]x[mode][ww]posr.arf (ancillary response file (ARF) generated by `xrtproducts`. Using response matrix associated with the observation date.)
  - [obsid]_x[mode][ww]posr.arf (ARF generated by `xrtmkarf`. Using the newest response matrix.)

Also, the script will create a 'log' folder at the current directory. Please ensure no 'log' folder contains any important files in the current directory before. 

## Required packages, programs & files:

**Python packages**: 
- os, glob, re, subprocess, time, shutil
- astropy, astroquery
- concurrent

**Programs**:
- Heasoft (current version 6.31.1)
- Calibration files data base (CALDB)

**Before running this script**, use `DS9` to open a PC mode sk image to choose the source & background region and save them separatly into two files named **"src.reg"** and **"back.reg"**. These two file need to be moved into **the directory where contains the python scripts**. 

Also, please confirm that you have installed the SWIFR/XRT calibration files properly. You could use `caldbinfo` to check if the SWIFT/XRT calibration files have been installed.
```
caldbinfo INST SWIFT XRT
```
And this should return:
```
 ...... CALDB is configured for the XRT instrument onboard SWIFT
 ......... Cal Index File: $CALDB/data/swift/xrt/caldb.indx
 ......... Instrument directory: $CALDB/data/swift/xrt
 ... CALDB appears to be set-up & accessible
```
Don't forget activating the **heasoft environment** befor running the scripts.

## Usage 
```
python3 xrt_repro.py [-h] --indir INDIR --outdir OUTDIR --obsobject OBSOBJECT [--pc-binsize PC_BINSIZE] [--wt-binsize WT_BINSIZE] [--pilow PILOW] [--pihigh PIHIGH] [--pcrmf PCRMF] [--wtrmf WTRMF] [--spec_binsize SPEC_BINSIZE]
```

**Optional arguments:**
 ```  
   -h, --help                   show this help message and exit
   
   --indir INDIR                Path to the data directory.
   
   --outdir OUTDIR              Path to the directory where you want to put your result files.
   
   --obsobject OBSOBJECT        Name of the source.
   
   --pc-binsize PC_BINSIZE      Time bin size for PC mode (s).The default value is **10s**.
   
   --wt-binsize WT_BINSIZE      Time bin size for WT mode (s). The default value is **1s**.
   
   --pilow PILOW                Minium PI for lc extract. The default value is **20**.
   
   --pihigh PIHIGH              Maxium PI for lc extract. The default value is **1000**.
   
   --pcrmf PCRMF                PC response matrix. The default value is **swxpc0to12s6_20130101v014.rmf** (The newest rmf).
   
   --wtrmf WTRMF                WT response matrix. The default value is **swxpc0to12s6_20130101v014.rmf** (The newest rmf).
   
   --spec_binsize SPEC_BINSIZE  Minium spectrum photon number per bin. The default value is **1**.
```
